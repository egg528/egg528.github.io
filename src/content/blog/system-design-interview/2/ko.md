---
title: "[가상 면접 사례로 배우는 대규모 시스템 설계 기초 1] 2장: 개략적인 규모 추정"
description: "시스템 설계에서 중요한 개략적인 규모 추정 방법을 학습합니다. 2의 제곱수를 활용한 데이터 양 계산, 응답 지연 시간 계산, 그리고 가용성 수치에 대해 알아봅니다."
date: "2023-06-05"
draft: false
---

개략적인 규모 추정은 보편적으로 통용되는 성능 수치상에서 사고 실험을 행하여 추정치를 구하는 행위로, 어떤 설계가 요구사항에 부합할 것인지 보기 위한 것입니다.


<br></br>

## 2의 제곱수

분산 시스템에서 다루는 데이터는 엄청나게 클 수 있으므로, 어떤 단위를 사용할지 올바르게 아는 것이 중요합니다.

![2의 제곱수 표](./diagram-1.webp)

### 데이터 양 단위
- **1 Byte** = 8 bits
- **1 KB (킬로바이트)** = 1,000 Byte = 10³ Byte
- **1 MB (메가바이트)** = 1,000 KB = 10⁶ Byte
- **1 GB (기가바이트)** = 1,000 MB = 10⁹ Byte
- **1 TB (테라바이트)** = 1,000 GB = 10¹² Byte
- **1 PB (페타바이트)** = 1,000 TB = 10¹⁵ Byte

### 추정 시 유용한 근사치
- **2¹⁰ = 1 thousand = 1 KB**
- **2²⁰ = 1 million = 1 MB**
- **2³⁰ = 1 billion = 1 GB**


<br></br>

## 모든 프로그래머가 알아야 하는 응답지연 값

### 컴퓨터 연산들의 응답지연
- **L1 cache reference**: 0.5ns
- **Branch mispredict**: 5ns
- **L2 cache reference**: 7ns (L1 cache reference 14배)
- **Mutex lock/unlock**: 25ns
- **Main memory reference**: 100ns (L1 cache 200배, L2 cache 14배)
- **Compress 1K bytes with Zippy**: 3,000ns = 3μs
- **Send 1K bytes over 1 Gbps network**: 10,000ns = 10μs
- **Read 4K randomly from SSD**: 150,000ns = 150μs
- **Read 1 MB sequentially from memory**: 250,000ns = 250μs
- **Round trip within same datacenter**: 500,000ns = 500μs
- **Read 1 MB sequentially from SSD**: 1,000,000ns = 1,000μs = 1ms
- **Disk seek**: 10,000,000ns = 10,000μs = 10ms
- **Read 1 MB sequentially from disk**: 20,000,000ns = 20,000μs = 20ms
- **Send packet CA → Netherlands → CA**: 150,000,000ns = 150,000μs = 150ms

![응답 지연 시간 비교](./diagram-2.webp)

### 지연 시간 수치 분석
- **메모리는 빠르지만 디스크는 아직도 느리다**
- **디스크 탐색은 가능한 한 피하라**
- **단순한 압축 알고리즘은 빠르다**
- **데이터를 인터넷으로 전송하기 전에 가능하면 압축하라**
- **데이터 센터는 보통 여러 지역에 분산되어 있고, 센터들 간에 데이터를 주고받는 데는 시간이 걸린다**


<br></br>

## 가용성에 관계된 수치들

고가용성(high availability)은 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭하는 용어입니다.

### 가용성 측정
- **100% = 시스템이 전혀 중단되지 않음**
- **99% = 연간 87.6시간 중단**
- **99.9% = 연간 8.8시간 중단**  
- **99.99% = 연간 52.6분 중단**
- **99.999% = 연간 5.3분 중단**

![가용성 수치와 허용 장애 시간](./diagram-3.webp)

### SLA (Service Level Agreement)
대다수 서비스는 99%에서 100% 사이의 SLA를 제공합니다. 아마존, 구글, 마이크로소프트 같은 사업자는 99.9% 이상의 SLA를 제공합니다.


<br></br>

## 추정 기법

### 트위터 QPS와 저장소 요구량 추정

**가정**
- 월간 능동 사용자(MAU) 3억 명
- 50%의 사용자가 일일 트위터 이용
- 평균적으로 각 사용자는 매일 2건의 트윗을 올림
- 미디어를 포함하는 트윗이 10%
- 데이터는 5년간 보관

**추정**

**QPS(Query Per Second) 추정:**
- 일간 능동 사용자(DAU) = 3억 × 50% = 1.5억
- 트윗 QPS = 1.5억 × 2 트윗 / 24시간 / 3600초 ≈ 3,500
- 최대 QPS(Peek QPS) = 2 × QPS = 7,000

**미디어 저장소 요구량:**
- 평균 트윗 크기: 
  - tweet_id: 64바이트
  - 텍스트: 140바이트
  - 미디어: 1MB
- 미디어 저장소: 1.5억 × 2 × 10% × 1MB = 30TB/일
- 5년간 미디어 저장소 요구량: 30TB × 365 × 5 ≈ 55PB

![트위터 시스템 추정](./diagram-4.webp)


<br></br>

## 실무에서 추정하기

### 추정의 목적
- **정확한 계산을 위한 것이 아닌 개략적 추정**
- **올바른 단위의 사용이 중요**
- **가정들을 명확히 적어두기**

### 추정 시 고려사항
- **반올림과 근사치**: 정확한 계산보다는 올바른 절차가 중요
- **가정을 명시**: 면접관과 공유하고 나중에 참고할 수 있도록 기록
- **단위를 명확하게**: KB, MB, GB 등의 단위 구분이 중요
- **QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수** 등의 기본 항목들 추정


<br></br>

## 정리

개략적인 규모 추정은 시스템 설계 면접에서 매우 중요한 기법입니다. 다음과 같은 것들을 염두에 두고 추정해야 합니다:

- **반올림과 근사치를 활용하라**: 복잡한 계산은 시간 낭비다
- **가정들을 명시하라**: 나중에 돌아와서 계산을 다시 해볼 수 있도록
- **단위를 명확히 하라**: 특히 데이터의 볼륨을 계산할 때는 더욱 중요하다
- **QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수** 같은 널리 출제되는 문제들을 풀어보라